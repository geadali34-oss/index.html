
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مَنْصَّة الجَمْعِيَّات التَّعاوُنِيَّة | تَنْظِيم الدَّفْعَات بِدُون فَوَائِد</title>
    <style>
        :root {
            --primary-blue: #1A5F7A;
            --primary-dark: #14455F;
            --primary-light: #2C8CB3;
            --secondary-blue: #0056A3;
            --success: #2E8B57;
            --warning: #FFB800;
            --danger: #DC3545;
            --dark: #2D3047;
            --light: #F8F9FA;
            --rajhi-red: #CE1126;
            --ahli-blue: #0056A3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(rgba(248, 249, 250, 0.95), rgba(248, 249, 250, 0.95)), 
                        url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBwYXR0ZXJuVHJhbnNmb3JtPSJyb3RhdGUoNDUpIj48cGF0aCBkPSJNIDAgMCBMIDQwIDQwIE0gMCAtNDAgTCA0MCAwIE0gLTQwIDAgTCAwIDQwIiBzdHJva2U9IiMxQTVGN0EiIHN0cm9rZS13aWR0aD0iMC41IiBmaWxsPSJub25lIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+');
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* تنسيقات النصوص العربية */
        .arabic-text {
            font-family: 'Cairo', sans-serif;
            line-height: 1.8;
            text-align: justify;
        }
        
        .text-success {
            color: var(--success) !important;
        }
        
        .text-danger {
            color: var(--danger) !important;
        }
        
        .text-warning {
            color: var(--warning) !important;
        }
        
        .text-primary {
            color: var(--primary-blue) !important;
        }
        
        /* رأس الصفحة */
        .main-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(26, 95, 122, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 2.5em;
            background: white;
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo-text h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo-text p {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        /* شريط التنقل */
        .main-nav {
            background: white;
            padding: 0 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-list {
            display: flex;
            list-style: none;
            justify-content: center;
        }
        
        .nav-item {
            padding: 20px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
        }
        
        .nav-item:hover {
            color: var(--primary-blue);
            background: rgba(26, 95, 122, 0.05);
        }
        
        .nav-item.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }
        
        /* المحتوى الرئيسي */
        .main-content {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .page-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .page-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* بطاقات التصميم */
        .section-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid #e1e5eb;
        }
        
        .section-title {
            color: var(--primary-blue);
            font-size: 2em;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }
        
        /* صفحة التعريف بالجمعية */
        .intro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .intro-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            border-right: 5px solid var(--primary-blue);
            transition: transform 0.3s;
            text-align: center;
        }
        
        .intro-card:hover {
            transform: translateY(-5px);
        }
        
        .intro-card h3 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            font-weight: 600;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #FFF3CD, #FFEEBA);
            border: 2px solid #FFEEBA;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            color: #856404;
            text-align: center;
        }
        
        .warning-box h4 {
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            font-weight: 600;
        }
        
        /* صفحة التسجيل */
        .registration-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        
        .step-indicator {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin: 0 auto 10px;
            transition: all 0.3s;
        }
        
        .step-indicator.active .step-number {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(26, 95, 122, 0.3);
        }
        
        .step-line {
            position: absolute;
            top: 25px;
            right: 10%;
            left: 10%;
            height: 3px;
            background: #e9ecef;
            z-index: 0;
        }
        
        /* نموذج التسجيل */
        .reg-form {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Cairo', sans-serif;
        }
        
        .form-input:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
            outline: none;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f1f3f4;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Cairo', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(26, 95, 122, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
        }
        
        /* اختيار الجمعية */
        .plans-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .plan-card {
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            background: white;
            text-align: center;
        }
        
        .plan-card:hover {
            border-color: var(--primary-blue);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .plan-card.selected {
            border-color: var(--primary-blue);
            background: rgba(26, 95, 122, 0.05);
        }
        
        .plan-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-blue);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .plan-price {
            font-size: 2em;
            font-weight: 800;
            color: var(--primary-blue);
            margin: 15px 0;
        }
        
        .plan-features {
            list-style: none;
            margin: 15px 0;
            text-align: right;
        }
        
        .plan-features li {
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            justify-content: flex-end;
        }
        
        /* رفع الإيصال */
        .receipt-upload {
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .receipt-upload:hover {
            border-color: var(--primary-blue);
            background: rgba(26, 95, 122, 0.05);
        }
        
        .receipt-upload i {
            font-size: 3em;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }
        
        /* لوحة التحكم */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary-blue);
            transition: transform 0.3s;
            text-align: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 800;
            color: var(--primary-blue);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        /* صفحة الدردشة */
        .chat-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
            height: 600px;
        }
        
        .chat-sidebar {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chat-messages {
            background: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .messages-header {
            padding: 20px;
            border-bottom: 2px solid #f1f3f4;
            background: var(--primary-blue);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .messages-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message-input {
            padding: 20px;
            border-top: 2px solid #f1f3f4;
        }
        
        /* تذييل الصفحة */
        .main-footer {
            background: var(--dark);
            color: white;
            padding: 50px 30px 20px;
            margin-top: 50px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }
        
        .footer-section h3 {
            color: white;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-blue);
            font-weight: 600;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #adb5bd;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid #495057;
            color: #adb5bd;
            font-size: 0.9em;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .main-nav {
                padding: 0 15px;
            }
            
            .nav-list {
                flex-direction: column;
            }
            
            .nav-item {
                padding: 15px;
                text-align: center;
                justify-content: center;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .plans-container {
                grid-template-columns: 1fr;
            }
            
            .chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .registration-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .step-line {
                display: none;
            }
            
            .section-card {
                padding: 20px;
            }
            
            .main-content {
                padding: 0 10px;
            }
        }
        
        /* تحسينات إضافية */
        .form-input::placeholder {
            color: #adb5bd;
            font-family: 'Cairo', sans-serif;
        }
        
        select.form-input {
            cursor: pointer;
        }
        
        .required-field::after {
            content: " *";
            color: var(--danger);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* تنسيقات الحركات العربية */
        .tashkeel {
            font-family: 'Cairo', sans-serif;
            letter-spacing: normal;
        }
        
        /* تنسيقات للأرقام */
        .number {
            font-family: 'Cairo', sans-serif;
            direction: ltr;
            display: inline-block;
        }
        
        /* تحسينات للرسائل */
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .message.user {
            background: var(--primary-light);
            color: white;
            margin-left: auto;
            text-align: left;
        }
        
        .message.system {
            background: #f1f3f4;
            color: #495057;
            margin-right: auto;
            text-align: right;
        }
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="arabic-text">
    <!-- رأس الصفحة -->
    <header class="main-header">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-hands-helping"></i>
            </div>
            <div class="logo-text">
                <h1 class="tashkeel">مَنْصَّة الجَمْعِيَّات التَّعاوُنِيَّة</h1>
                <p>تَنْظِيم الدَّفْعَات بِدُون فَوَائِد • نِظَام تَوْفِير جَمَاعِيّ آمِن</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openLogin()">
                <i class="fas fa-sign-in-alt"></i> دُخُول الأَعْضَاء
            </button>
        </div>
    </header>
    
    <!-- شريط التنقل -->
    <nav class="main-nav">
        <ul class="nav-list">
            <li class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home"></i> الرَّئِيسِيَّة
            </li>
            <li class="nav-item" onclick="showPage('register')">
                <i class="fas fa-user-plus"></i> التَّسْجِيل
            </li>
            <li class="nav-item" onclick="showPage('dashboard')">
                <i class="fas fa-tachometer-alt"></i> لَوْحَة التَّحَكُّم
            </li>
            <li class="nav-item" onclick="showPage('chat')">
                <i class="fas fa-comments"></i> الدَّرْدَشَة
            </li>
            <li class="nav-item" onclick="showPage('about')">
                <i class="fas fa-info-circle"></i> عَن الجَمْعِيَّة
            </li>
        </ul>
    </nav>
    
    <!-- المحتوى الرئيسي -->
    <main class="main-content">
        <!-- الصفحة الرئيسية -->
        <section id="home" class="page-section active">
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-hands-helping"></i> مَرْحَبًا بِكَ فِي مَنْصَّة الجَمْعِيَّات التَّعاوُنِيَّة
                </h2>
                
                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> مُلاحَظَة هَامَّة:</h4>
                    <p class="tashkeel">الجَمْعِيَّة لَيْسَتِ اسْتِثْمَارًا وَلَا تَقَدِّمُ أَرْبَاحًا. هَذَا نِظَام تَوْفِير جَمَاعِيّ لِتَنْظِيم الدَّفْعَات بِدُون فَوَائِد أَوْ أَرْبَاح. كُلُّ عُضْوٍ يَحْصُلُ عَلَى مَبْلَغِ الجَمْعِيَّة مَرَّةً وَاحِدَةً حَسَبَ دَوْرِ الاسْتِلَامِ المُحَدَّدِ لَهُ.</p>
                </div>
                
                <div class="intro-grid">
                    <div class="intro-card">
                        <h3><i class="fas fa-handshake text-success"></i> مَفْهُوم الجَمْعِيَّة</h3>
                        <p class="tashkeel">نِظَام تَوْفِير جَمَاعِيّ حَيْثُ يَجْتَمِعُ عَدَدٌ مِنَ الأَفْرَادِ عَلَى دَفْعَةٍ شَهْرِيَّةٍ ثَابِتَةٍ، وَيَحْصُلُ كُلُّ عُضْوٍ عَلَى مَجْمُوعِ الدَّفْعَاتِ مَرَّةً وَاحِدَةً حَسَبَ الدَّوْرِ المُحَدَّدِ لَهُ.</p>
                    </div>
                    
                    <div class="intro-card">
                        <h3><i class="fas fa-shield-alt text-primary"></i> الأَمَان وَالشَّفَافِيَّة</h3>
                        <p class="tashkeel">جَمِيعُ العَمَلِيَّاتِ مُسَجَّلَةٌ وَشَفَّافَةٌ. رَبْطٌ مُبَاشَرٌ مَعَ الحَسَابَاتِ البَنْكِيَّةِ لِلْقِرَاءَةِ فَقَطْ. لَا يُوجَدُ وَصُولٌ لِأَمْوَالِ الأَعْضَاءِ.</p>
                    </div>
                    
                    <div class="intro-card">
                        <h3><i class="fas fa-calendar-check text-warning"></i> نِظَام الأَدْوَار</h3>
                        <p class="tashkeel">كُلُّ عُضْوٍ يَحْصُلُ عَلَى دَوْرٍ ثَابِتٍ لِلِاسْتِلَامِ. النِّظَامُ يَضْمَنُ العَدَالَةَ وَالتَّنْظِيمَ الدَّقِيقَ لِلْأَدْوَارِ بِنَاءً عَلَى تَسَلْسُلِ الانْضِمَامِ.</p>
                    </div>
                    
                    <div class="intro-card">
                        <h3><i class="fas fa-users" style="color: #CE1126;"></i> مُجْتَمَعٌ مُتَعَاوِن</h3>
                        <p class="tashkeel">نَعْمَلُ عَلَى بِنَاءِ مُجْتَمَعٍ تَعَاوُنِيٍّ يُسَاعِدُ بَعْضَهُ البَعْضَ فِي تَحْقِيقِ أَهْدَافِ التَّوْفِيرِ بِطَرِيقَةٍ مُنَظَّمَةٍ وَآمِنَةٍ.</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-primary" onclick="showPage('register')" style="padding: 20px 50px; font-size: 1.2em;">
                        <i class="fas fa-user-plus"></i> ابْدَأ التَّسْجِيلَ الآنَ
                    </button>
                </div>
            </div>
        </section>
        
        <!-- صفحة التسجيل -->
        <section id="register" class="page-section">
            <div class="section-card">
                <h2 class="section-title"><i class="fas fa-user-plus"></i> تَسْجِيل عُضْو جَدِيد</h2>
                
                <!-- خطوات التسجيل -->
                <div class="registration-steps">
                    <div class="step-line"></div>
                    <div class="step-indicator active" id="step1-indicator">
                        <div class="step-number">١</div>
                        <div>البَيَانَات الشَّخْصِيَّة</div>
                    </div>
                    <div class="step-indicator" id="step2-indicator">
                        <div class="step-number">٢</div>
                        <div>اخْتِيَار الجَمْعِيَّة</div>
                    </div>
                    <div class="step-indicator" id="step3-indicator">
                        <div class="step-number">٣</div>
                        <div>التَّأْكِيد وَالدَّفْع</div>
                    </div>
                </div>
                
                <!-- نموذج التسجيل -->
                <form id="registrationForm" class="reg-form">
                    <!-- الخطوة 1: البيانات الشخصية -->
                    <div class="form-step active" id="step1-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-user text-success"></i> الاسْم بِالكَامِل *</label>
                                <input type="text" class="form-input" id="fullName" required placeholder="أَدْخِل اسْمَك الكَامِل" pattern="[\u0600-\u06FF\s]{3,}">
                                <small class="text-danger" id="fullNameError" style="display: none; margin-top: 5px;">الرَّجَاء إِدْخَال اسم صَحِيح (عربي فقط)</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-id-card text-primary"></i> رَقَم الهُوِيَّة الوَطَنِيَّة *</label>
                                <input type="text" class="form-input" id="nationalId" required pattern="[0-9]{10}" placeholder="١٠ أَرْقَام" maxlength="10">
                                <small class="text-danger" id="nationalIdError" style="display: none; margin-top: 5px;">رَقَم الهُوِيَّة يَجِب أَنْ يَكُونَ ١٠ أَرْقَام</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-phone" style="color: #CE1126;"></i> رَقَم الجَوَّال *</label>
                                <input type="tel" class="form-input" id="phone" required pattern="05[0-9]{8}" placeholder="٠٥xxxxxxxx" maxlength="10">
                                <small class="text-danger" id="phoneError" style="display: none; margin-top: 5px;">رَقَم الجَوَّال يَجِب أَنْ يَبْدَأ بـ ٠٥ وَيَكُونَ ١٠ أَرْقَام</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-envelope text-warning"></i> البَرِيد الإلِكْتِرُونِيّ *</label>
                                <input type="email" class="form-input" id="email" required placeholder="example@email.com">
                                <small class="text-danger" id="emailError" style="display: none; margin-top: 5px;">الرَّجَاء إِدْخَال بَرِيد إلِكْتِرُونِيّ صَحِيح</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-city text-success"></i> المَدِينَة *</label>
                                <select class="form-input" id="city" required>
                                    <option value="">اخْتَر المَدِينَة</option>
                                    <option value="riyadh">الرِّيَاض</option>
                                    <option value="jeddah">جِدَّة</option>
                                    <option value="mecca">مَكَّة المُكَرَّمَة</option>
                                    <option value="medina">المَدِينَة المُنَوَّرَة</option>
                                    <option value="dammam">الدَّمَام</option>
                                    <option value="khobar">الخُبَر</option>
                                    <option value="dhahran">الظَّهْرَان</option>
                                    <option value="ahsa">الأَحْسَاء</option>
                                    <option value="qatif">القَطِيف</option>
                                    <option value="taif">الطَّائِف</option>
                                    <option value="buraidah">بُرَيْدَة</option>
                                    <option value="hail">حَائِل</option>
                                    <option value="tabuk">تَبُوك</option>
                                    <option value="jazan">جَازَان</option>
                                    <option value="najran">نَجْرَان</option>
                                    <option value="abha">أَبْهَا</option>
                                    <option value="khamis">خَمِيس مُشَيْط</option>
                                    <option value="yanbu">يَنْبُع</option>
                                    <option value="jubail">الجُبَيْل</option>
                                    <option value="hafr">حَفْر البَاطِن</option>
                                    <option value="qassim">القَصِيم</option>
                                    <option value="asir">عَسِير</option>
                                    <option value="bahah">البَاحَة</option>
                                    <option value="jawf">الجُوف</option>
                                    <option value="northern">الحُدُود الشَّمَالِيَّة</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="required-field"><i class="fas fa-birthday-cake text-primary"></i> تَارِيخ المِيلَاد *</label>
                                <input type="date" class="form-input" id="birthDate" required max="2006-01-01">
                                <small class="text-danger" id="birthDateError" style="display: none; margin-top: 5px;">يَجِب أَنْ يَكُونَ العُمْر ١٨ سَنَةً فَأَكْثَر</small>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="validateAndNext(1)">
                                التَّالِي <i class="fas fa-arrow-left"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- الخطوة 2: اختيار الجمعية -->
                    <div class="form-step" id="step2-form">
                        <h3 style="color: var(--primary-blue); margin-bottom: 30px; text-align: center;">
                            <i class="fas fa-money-check-alt"></i> اخْتَر نَوْع الجَمْعِيَّة المُنَاسِب لَك
                        </h3>
                        
                        <div class="plans-container">
                            <!-- باقة 500 ريال -->
                            <div class="plan-card" data-plan="500" onclick="selectPlan('500')">
                                <div class="plan-badge">الأَكْثَر شُيُوعًا</div>
                                <h3><i class="fas fa-coins text-warning"></i> جَمْعِيَّة ٥٠٠ رِيَال</h3>
                                <div class="plan-price"><span class="number">500</span> ر.س</div>
                                <p class="tashkeel">شَهْرِيًّا لِمُدَّة ١٢ شَهْرًا</p>
                                <ul class="plan-features">
                                    <li><i class="fas fa-check-circle text-success"></i> مَبْلَغ مُنَاسِب لِلْجَمِيع</li>
                                    <li><i class="fas fa-check-circle text-success"></i> دَوْر اسْتِلَام مُحَدَّد</li>
                                    <li><i class="fas fa-check-circle text-success"></i> مُتَابَعَة شَهْرِيَّة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> إِشْعَارَات تِلْقَائِيَّة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> دَعْم فَنِّيّ مُتَكَامِل</li>
                                </ul>
                                <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="selectPlan('500')">
                                    <i class="fas fa-check"></i> اخْتَر هَذِهِ الجَمْعِيَّة
                                </button>
                            </div>
                            
                            <!-- باقة 1000 ريال -->
                            <div class="plan-card" data-plan="1000" onclick="selectPlan('1000')">
                                <div class="plan-badge">الأَفْضَل قِيمَة</div>
                                <h3><i class="fas fa-gem text-primary"></i> جَمْعِيَّة ١٬٠٠٠ رِيَال</h3>
                                <div class="plan-price"><span class="number">1,000</span> ر.س</div>
                                <p class="tashkeel">شَهْرِيًّا لِمُدَّة ١٢ شَهْرًا</p>
                                <ul class="plan-features">
                                    <li><i class="fas fa-check-circle text-success"></i> جَمِيع مُمَيِّزَات ٥٠٠ رِيَال</li>
                                    <li><i class="fas fa-check-circle text-success"></i> تَأْمِين إِضَافِيّ</li>
                                    <li><i class="fas fa-check-circle text-success"></i> مُتَابَعَة شَخْصِيَّة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> أُوْلَوِيَّة فِي الدَّوْر</li>
                                    <li><i class="fas fa-check-circle text-success"></i> تَقَارِير شَهْرِيَّة</li>
                                </ul>
                                <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="selectPlan('1000')">
                                    <i class="fas fa-check"></i> اخْتَر هَذِهِ الجَمْعِيَّة
                                </button>
                            </div>
                            
                            <!-- باقة 5000 ريال -->
                            <div class="plan-card" data-plan="5000" onclick="selectPlan('5000')">
                                <div class="plan-badge">VIP</div>
                                <h3><i class="fas fa-crown" style="color: #CE1126;"></i> جَمْعِيَّة ٥٬٠٠٠ رِيَال</h3>
                                <div class="plan-price"><span class="number">5,000</span> ر.س</div>
                                <p class="tashkeel">شَهْرِيًّا لِمُدَّة ١٢ شَهْرًا</p>
                                <ul class="plan-features">
                                    <li><i class="fas fa-check-circle text-success"></i> جَمِيع المُمَيِّزَات السَّابِقَة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> ضَمَانَات إِضَافِيَّة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> مَحْفَظَة رَقَمِيَّة</li>
                                    <li><i class="fas fa-check-circle text-success"></i> دَعْم فَوْرِيّ ٢٤/٧</li>
                                    <li><i class="fas fa-check-circle text-success"></i> مُدِير حِسَاب شَخْصِيّ</li>
                                </ul>
                                <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="selectPlan('5000')">
                                    <i class="fas fa-check"></i> اخْتَر هَذِهِ الجَمْعِيَّة
                                </button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; color: #6c757d; font-size: 0.9em;">
                            <p id="selectedPlanText" style="display: none; color: var(--primary-blue); font-weight: 600;">
                                <i class="fas fa-check-circle text-success"></i> تَمَّ اخْتِيَار جَمْعِيَّة <span id="selectedPlanName"></span>
                            </p>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                <i class="fas fa-arrow-right"></i> السَّابِق
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextStep(3)" id="nextStep3Btn">
                                التَّالِي <i class="fas fa-arrow-left"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- الخطوة 3: التأكيد والدفع -->
                    <div class="form-step" id="step3-form">
                        <h3 style="color: var(--primary-blue); margin-bottom: 30px; text-align: center;">
                            <i class="fas fa-clipboard-check"></i> تَأْكِيد البَيَانَات وَالدَّفْع
                        </h3>
                        
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                            <h4 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-user-check"></i> بَيَانَات التَّسْجِيل:
                            </h4>
                            <div id="reviewData"></div>
                        </div>
                        
                        <!-- عرض رقم حساب الجمعية -->
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: center;">
                            <h4 style="color: var(--primary-blue); margin-bottom: 15px;">
                                <i class="fas fa-university"></i> رَقَم حِسَاب الجَمْعِيَّة (IBAN)
                            </h4>
                            <div style="background: white; padding: 20px; border-radius: 10px; border: 2px dashed var(--primary-blue); direction: ltr; text-align: center; font-family: monospace; font-size: 1.2em; font-weight: bold; color: var(--primary-blue);">
                                SA035600035686889898989898585
                            </div>
                            <p style="color: #6c757d; margin-top: 15px;" class="tashkeel">
                                <i class="fas fa-info-circle"></i> يُرْجَى التَّأَكُّدُ مِنْ مُطَابَقَةِ رَقَمِ الحِسَابِ أَعْلاهُ قَبْلَ التَّحْوِيل
                            </p>
                        </div>
                        
                        <!-- اختيار البنك مع الشعارات المصححة -->
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px;" class="required-field">
                                <i class="fas fa-university text-primary"></i> اخْتَر طَرِيقَة الرَّبْط البَنْكِيّ *
                            </label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;">
                                <!-- بنك الراجحي -->
                                <div id="rajhi-option" class="bank-option" onclick="selectBank('rajhi')" style="padding: 20px; border: 2px solid #dee2e6; border-radius: 12px; cursor: pointer; text-align: center; background: white; transition: all 0.3s;">
                                    <div style="display: flex; align-items: center; justify-content: center; height: 80px; margin-bottom: 10px;">
                                        <img src="https://upload.wikimedia.org/wikipedia/ar/3/3e/Al_Rajhi_Bank_Logo.svg" alt="بَنْك الرَّاجِحِيّ" style="max-width: 180px; max-height: 60px; width: auto; height: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                                    </div>
                                    <h4 style="color: var(--rajhi-red); margin-bottom: 10px;">بَنْك الرَّاجِحِيّ</h4>
                                    <button type="button" onclick="openBankApp('rajhi')" style="margin-top: 10px; padding: 10px 20px; background: linear-gradient(135deg, var(--rajhi-red), #b30f22); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%;">
                                        <i class="fas fa-external-link-alt"></i> فَتْح تَطْبِيق الرَّاجِحِيّ
                                    </button>
                                </div>
                                
                                <!-- البنك الأهلي -->
                                <div id="ahli-option" class="bank-option" onclick="selectBank('ahli')" style="padding: 20px; border: 2px solid #dee2e6; border-radius: 12px; cursor: pointer; text-align: center; background: white; transition: all 0.3s;">
                                    <div style="display: flex; align-items: center; justify-content: center; height: 80px; margin-bottom: 10px;">
                                        <img src="https://upload.wikimedia.org/wikipedia/ar/6/6d/Saudi_National_Bank_Logo.svg" alt="البَنْك الأَهْلِيّ السُّعُودِيّ" style="max-width: 180px; max-height: 60px; width: auto; height: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                                    </div>
                                    <h4 style="color: var(--ahli-blue); margin-bottom: 10px;">البَنْك الأَهْلِيّ السُّعُودِيّ</h4>
                                    <button type="button" onclick="openBankApp('ahli')" style="margin-top: 10px; padding: 10px 20px; background: linear-gradient(135deg, var(--ahli-blue), #004a8c); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%;">
                                        <i class="fas fa-external-link-alt"></i> فَتْح تَطْبِيق الأَهْلِيّ
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- رفع الإيصال -->
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px;" class="required-field">
                                <i class="fas fa-receipt text-primary"></i> رَفْع إِيصَال الدَّفْع الأَوَّل *
                            </label>
                            <div class="receipt-upload" onclick="document.getElementById('receiptFile').click()" id="receiptUpload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>اضْغَطْ لِرَفْع الإِيصَال</h4>
                                <p style="color: #6c757d; margin-top: 10px;">الصِّيَغ المَدْعُومَة: JPG, PNG, PDF</p>
                                <p id="fileName" style="color: var(--primary-blue); font-weight: 600; margin-top: 10px;"></p>
                            </div>
                            <input type="file" id="receiptFile" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" onchange="handleReceiptUpload(this)">
                        </div>
                        
                        <!-- الشروط -->
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="agreeTerms" required style="width: 20px; height: 20px;">
                                <span class="tashkeel">أُوافِقُ عَلَى شُرُوطٍ وَأَحْكَامِ الجَمْعِيَّةِ وَسِيَاسَةِ الخُصُوصِيَّة *</span>
                            </label>
                        </div>
                        
                        <div class="warning-box" style="margin: 30px 0;">
                            <h4><i class="fas fa-info-circle"></i> مُلاحَظَة هَامَّة:</h4>
                            <p class="tashkeel">الرَّبْط البَنْكِيّ لِلْقِرَاءَةِ فَقَطْ لِتَتَبُّعِ الدَّفْعَات. لَنْ نَتَمَكَّنَ مِنَ الوُصُولِ إِلَى أَمْوَالِكَ أَوْ سَحْبِهَا.</p>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                <i class="fas fa-arrow-right"></i> السَّابِق
                            </button>
                            <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitRegistration()">
                                <i class="fas fa-check-circle"></i> تَأْكِيد التَّسْجِيل
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </section>
        
        <!-- صفحة لوحة التحكم -->
        <section id="dashboard" class="page-section">
            <div class="section-card">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> لَوْحَة التَّحَكُّم</h2>
                
                <div id="loginPrompt" style="text-align: center; padding: 50px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 20px;">تَسْجِيل الدُّخُول</h3>
                    <p style="color: #6c757d; margin-bottom: 30px;" class="tashkeel">أَدْخِلْ رَقَمَ الجَوَّالِ لِلدُّخُولِ إِلَى حِسَابِكَ</p>
                    
                    <div style="max-width: 400px; margin: 0 auto;">
                        <input type="tel" class="form-input" id="loginPhone" placeholder="أَدْخِلْ رَقَمَ الجَوَّال المُسَجَّل" style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="loginUser()" style="width: 100%;">
                            <i class="fas fa-sign-in-alt"></i> تَسْجِيل الدُّخُول
                        </button>
                    </div>
                    
                    <p style="color: #6c757d; margin-top: 20px; font-size: 0.9em;" class="tashkeel">
                        إِذَا كُنْتَ مُسَجَّلًا مِنْ قَبْلُ، سَيَتِمُّ تَحْمِيلُ بَيَانَاتِكَ تِلْقَائِيًّا
                    </p>
                </div>
                
                <div id="dashboardContent" style="display: none;">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <h3><i class="fas fa-user text-success"></i> بَيَانَات العُضْو</h3>
                            <div class="stat-value" id="userName">-</div>
                            <div class="stat-label" id="userId">رَقَم العُضْو: -</div>
                        </div>
                        
                        <div class="stat-card">
                            <h3><i class="fas fa-coins text-warning"></i> الجَمْعِيَّة</h3>
                            <div class="stat-value" id="userPlan">-</div>
                            <div class="stat-label" id="userRole">الدَّوْر: -</div>
                        </div>
                        
                        <div class="stat-card">
                            <h3><i class="fas fa-money-check text-primary"></i> المَدْفُوعَات</h3>
                            <div class="stat-value" id="totalPaid">٠ ر.س</div>
                            <div class="stat-label">إِجْمَالِيّ المَدْفُوع</div>
                        </div>
                        
                        <div class="stat-card">
                            <h3><i class="fas fa-calendar-check" style="color: #CE1126;"></i> الاسْتِلَام</h3>
                            <div class="stat-value" id="receiveDate">-</div>
                            <div class="stat-label">تَارِيخ الاسْتِلَام المُتَوَقَّع</div>
                        </div>
                    </div>
                    
                    <!-- رفع الإيصالات -->
                    <div style="margin-top: 40px;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-receipt"></i> رَفْع إِيصَالَات الدَّفْع
                        </h3>
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 15px;">
                            <div class="receipt-upload" onclick="document.getElementById('paymentReceipt').click()" id="paymentReceiptUpload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>اضْغَطْ لِرَفْع إِيصَال الدَّفْع الشَّهْرِيّ</h4>
                                <p style="color: #6c757d; margin-top: 10px;">الصِّيَغ المَدْعُومَة: JPG, PNG, PDF</p>
                            </div>
                            <input type="file" id="paymentReceipt" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" onchange="handlePaymentReceipt(this)">
                        </div>
                    </div>
                    
                    <!-- سجل الدفعات -->
                    <div style="margin-top: 40px;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-history"></i> سِجِلُّ الدَّفْعَات
                        </h3>
                        <div id="paymentHistory" style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                            <p style="color: #6c757d; text-align: center;">لَا تُوجَدُ دَفْعَات مُسَجَّلَة بَعْد</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- صفحة الدردشة -->
        <section id="chat" class="page-section">
            <div class="section-card">
                <h2 class="section-title"><i class="fas fa-comments"></i> الدَّرْدَشَة وَالدَّعْم</h2>
                
                <div class="chat-container">
                    <div class="chat-sidebar">
                        <div style="padding: 20px; background: var(--primary-blue); color: white;">
                            <h3 style="margin: 0;">الدَّرْدَشَات النَّشِطَة</h3>
                        </div>
                        <div id="chatContacts" style="padding: 20px;">
                            <div class="chat-contact active" onclick="openChat('admin')" style="padding: 15px; border-bottom: 1px solid #dee2e6; cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-headset"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600;">الدَّعْم الفَنِّيّ</div>
                                        <div style="font-size: 0.85em; color: #6c757d;">مُتَّصِل الآنَ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-messages">
                        <div class="messages-header">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 40px; height: 40px; background: white; color: var(--primary-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-headset"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1em;">الدَّعْم الفَنِّيّ</div>
                                    <div style="font-size: 0.85em; opacity: 0.9;">يَدْعَمُكَ فِي جَمِيعِ اسْتِفْسَارَاتِ الجَمْعِيَّة</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="messages-list" id="messagesList">
                            <!-- الرسائل ستظهر هنا -->
                        </div>
                        
                        <div class="message-input">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="chatInput" class="form-input" placeholder="اكْتُبْ رِسَالَتَكَ هُنَا..." style="flex: 1;">
                                <button class="btn btn-primary" onclick="sendMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- صفحة عن الجمعية -->
        <section id="about" class="page-section">
            <div class="section-card">
                <h2 class="section-title"><i class="fas fa-info-circle"></i> نُبْذَة عَن الجَمْعِيَّة</h2>
                
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-university"></i> تَعْرِيف الجَمْعِيَّة
                    </h3>
                    <p style="line-height: 1.8; color: #495057; font-size: 1.1em; margin-bottom: 20px;" class="tashkeel">
                        الجَمْعِيَّة التَّعَاوُنِيَّةُ هِيَ نِظَامُ تَوْفِيرٍ جَمَاعِيٍّ يَهْدِفُ إِلَى تَنْظِيمِ المَدَّخَرَاتِ بَيْنَ مَجْمُوعَةٍ مِنَ الأَفْرَادِ بِشَكْلٍ دَوْرِيٍّ وَمُنَظَّمٍ. 
                        تَعْمَلُ عَلَى مَبْدَأِ التَّعَاوُنِ وَالتَّكَافُلِ الاجْتِمَاعِيِّ حَيْثُ يَلْتَزِمُ كُلُّ عُضْوٍ بِدَفْعِ مَبْلَغٍ شَهْرِيٍّ ثَابِتٍ، وَيَحْصُلُ كُلُّ عُضْوٍ عَلَى مَجْمُوعِ 
                        المَدَّخَرَاتِ دَفْعَةً وَاحِدَةً حَسَبَ الدَّوْرِ المُحَدَّدِ لَهُ مُسْبَقًا.
                    </p>
                    
                    <div class="warning-box">
                        <h4><i class="fas fa-exclamation-circle"></i> تَنْوِيه هَامّ:</h4>
                        <p class="tashkeel">الجَمْعِيَّة <strong>لَيْسَتِ اسْتِثْمَارًا</strong> وَلَا تَقَدِّمُ <strong>أَرْبَاحًا أَوْ فَوَائِد</strong>. النِّظَامُ مَبْنِيٌّ عَلَى أَسَاسِ 
                        <strong>التَّوْفِيرِ الجَمَاعِيِّ المُنَظَّمِ</strong> فَقَطْ. كُلُّ عُضْوٍ يَسْتَرِدُّ مَا دَفَعَهُ بِالكَامِلِ حَسَبَ دَوْرِ الاسْتِلَامِ المُحَدَّدِ لَهُ.</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 40px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-bullseye"></i> أَهْدَاف الجَمْعِيَّة
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-right: 4px solid var(--primary-blue);">
                            <h4><i class="fas fa-hand-holding-usd text-success"></i> تَنْظِيم التَّوْفِير</h4>
                            <p style="color: #495057; margin-top: 10px;" class="tashkeel">مُسَاعَدَةُ الأَفْرَادِ عَلَى تَنْظِيمِ مَدَّخَرَاتِهِمْ بِشَكْلٍ دَوْرِيٍّ وَمُنَظَّمٍ.</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-right: 4px solid var(--primary-blue);">
                            <h4><i class="fas fa-users text-primary"></i> تَعْزِيز التَّعَاوُن</h4>
                            <p style="color: #495057; margin-top: 10px;" class="tashkeel">بِنَاءُ مُجْتَمَعٍ تَعَاوُنِيٍّ يُسَاعِدُ بَعْضَهُ البَعْضَ فِي تَحْقِيقِ الأَهْدَافِ المَالِيَّةِ.</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-right: 4px solid var(--primary-blue);">
                            <h4><i class="fas fa-shield-alt" style="color: #CE1126;"></i> الأَمَان وَالشَّفَافِيَّة</h4>
                            <p style="color: #495057; margin-top: 10px;" class="tashkeel">تَوْفِيرُ بِيئَةٍ آمِنَةٍ وَشَفَّافَةٍ لِجَمِيعِ العَمَلِيَّاتِ المَالِيَّةِ.</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; border-right: 4px solid var(--primary-blue);">
                            <h4><i class="fas fa-balance-scale text-warning"></i> العَدَالَة وَالتَّنْظِيم</h4>
                            <p style="color: #495057; margin-top: 10px;" class="tashkeel">ضَمَانُ العَدَالَةِ فِي تَوْزِيعِ الأَدْوَارِ وَالِالْتِزَامِ بِالجَدْوَلِ الزَّمَنِيِّ.</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: var(--primary-blue); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-phone-alt"></i> التَّوَاصُل مَعَنَا
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px;">
                        <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2.5em; color: var(--primary-blue); margin-bottom: 15px;"><i class="fas fa-phone"></i></div>
                            <h4>الهَاتِف</h4>
                            <p style="color: #495057; margin-top: 10px;" class="number">٩٢٠٠ ٢٠٢٠</p>
                        </div>
                        
                        <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2.5em; color: var(--primary-blue); margin-bottom: 15px;"><i class="fas fa-envelope"></i></div>
                            <h4>البَرِيد الإلِكْتِرُونِيّ</h4>
                            <p style="color: #495057; margin-top: 10px;">support@aljam3ia.com</p>
                        </div>
                        
                        <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2.5em; color: var(--primary-blue); margin-bottom: 15px;"><i class="fas fa-clock"></i></div>
                            <h4>سَاعَات العَمَل</h4>
                            <p style="color: #495057; margin-top: 10px;" class="tashkeel">٨ صَبَاحًا - ٤ مَسَاءً</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- تذييل الصفحة -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>عَن المَنْصَّة</h3>
                <p style="color: #adb5bd; line-height: 1.6;" class="tashkeel">مَنْصَّةُ الجَمْعِيَّاتِ التَّعَاوُنِيَّةِ - نِظَامُ تَوْفِيرٍ جَمَاعِيٍّ آمِنٍ وَشَفَّافٍ لِتَنْظِيمِ الدَّفْعَاتِ بِدُونِ فَوَائِدَ.</p>
            </div>
            
            <div class="footer-section">
                <h3>رَوَابِط سَرِيعَة</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showPage('home')"><i class="fas fa-home"></i> الرَّئِيسِيَّة</a></li>
                    <li><a href="#" onclick="showPage('register')"><i class="fas fa-user-plus"></i> التَّسْجِيل</a></li>
                    <li><a href="#" onclick="showPage('about')"><i class="fas fa-info-circle"></i> عَن الجَمْعِيَّة</a></li>
                    <li><a href="#" onclick="showPage('chat')"><i class="fas fa-comments"></i> الدَّرْدَشَة</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>التَّوَاصُل</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-phone"></i> <span class="number">٩٢٠٠ ٢٠٢٠</span></li>
                    <li><i class="fas fa-envelope"></i> support@aljam3ia.com</li>
                    <li><i class="fas fa-map-marker-alt"></i> المَمْلَكَة العَرَبِيَّة السُّعُودِيَّة</li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>حَسَابَات الجَمْعِيَّة</h3>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <div style="padding: 10px 15px; background: rgba(26, 95, 122, 0.2); border-radius: 8px; color: white;">
                        <i class="fas fa-university"></i> حِسَاب الجَمْعِيَّة
                    </div>
                    <div style="padding: 10px 15px; background: rgba(206, 17, 38, 0.2); border-radius: 8px; color: white;">
                        <i class="fas fa-credit-card"></i> IBAN
                    </div>
                </div>
                <div style="margin-top: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px; font-family: monospace; font-size: 0.9em;">
                    SA035600035686889898989898585
                </div>
            </div>
        </div>
        
        <div class="copyright">
            <p class="tashkeel">© ٢٠٢٤ مَنْصَّةُ الجَمْعِيَّاتِ التَّعَاوُنِيَّةِ. جَمِيعُ الحُقُوقِ مَحْفُوظَةٌ. | نِظَامُ تَنْظِيمِ الدَّفْعَاتِ بِدُونِ فَوَائِدَ</p>
        </div>
    </footer>
    
    <!-- نافذة تسجيل الدخول -->
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 40px; border-radius: 20px; max-width: 500px; width: 90%;">
            <h3 style="color: var(--primary-blue); margin-bottom: 30px; text-align: center;">تَسْجِيل الدُّخُول</h3>
            
            <div style="margin-bottom: 20px;">
                <label class="tashkeel">رَقَم الجَوَّال</label>
                <input type="tel" class="form-input" id="modalPhone" placeholder="أَدْخِلْ رَقَمَ الجَوَّال المُسَجَّل">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="closeLoginModal()" style="flex: 1;">
                    إِلْغَاء
                </button>
                <button class="btn btn-primary" onclick="modalLogin()" style="flex: 1;">
                    دُخُول
                </button>
            </div>
        </div>
    </div>
    
    <!-- نافذة الإشعارات -->
    <div id="notificationModal" style="display: none; position: fixed; bottom: 20px; left: 20px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 10000; max-width: 350px;">
        <div style="display: flex; align-items: start; gap: 15px;">
            <div style="font-size: 24px; color: var(--primary-blue);"><i class="fas fa-bell"></i></div>
            <div>
                <div style="font-weight: 600; color: var(--primary-blue); margin-bottom: 5px;">إِشْعَار</div>
                <div id="notificationMessage" style="color: #495057;" class="tashkeel"></div>
            </div>
            <button onclick="closeNotification()" style="background: none; border: none; color: #6c757d; cursor: pointer;">×</button>
        </div>
    </div>

    <script>
    // ==============================================
    // النظام الأساسي - الإصدار المصحح
    // ==============================================
    
    // المتغيرات العامة
    let currentUser = null;
    let currentStep = 1;
    let selectedPlan = null;
    let selectedBank = null;
    let receiptFile = null;
    
    // البيانات المخزنة
    const users = JSON.parse(localStorage.getItem('cooperative_users')) || [];
    const visitors = JSON.parse(localStorage.getItem('cooperative_visitors')) || [];
    const messages = JSON.parse(localStorage.getItem('cooperative_messages')) || [];
    
    // ==============================================
    // 1. تهيئة النظام
    // ==============================================
    
    function initSystem() {
        console.log('جاري تهيئة النظام...');
        trackVisitor();
        loadMessages();
        checkLoginStatus();
        setupEventListeners();
        
        // تهيئة خطوات التسجيل
        updateStepIndicators();
        
        // إعداد التواريخ
        setupDateInputs();
    }
    
    function setupDateInputs() {
        const today = new Date();
        const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
        const minDate = new Date(today.getFullYear() - 100, today.getMonth(), today.getDate());
        
        document.getElementById('birthDate').max = maxDate.toISOString().split('T')[0];
        document.getElementById('birthDate').min = minDate.toISOString().split('T')[0];
    }
    
    function updateStepIndicators() {
        document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
            indicator.classList.toggle('active', index + 1 === currentStep);
        });
    }
    
    // ==============================================
    // 2. إدارة الصفحات
    // ==============================================
    
    function showPage(pageId) {
        console.log('جاري التبديل إلى صفحة:', pageId);
        
        // إخفاء جميع الصفحات
        document.querySelectorAll('.page-section').forEach(page => {
            page.classList.remove('active');
        });
        
        // تحديث القائمة
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // إظهار الصفحة المطلوبة
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.add('active');
        }
        
        // تحديث النشطة في القائمة
        const activeItem = document.querySelector(`.nav-item:nth-child(${getNavIndex(pageId)})`);
        if (activeItem) {
            activeItem.classList.add('active');
        }
        
        // إذا كانت لوحة التحكم، تحديث البيانات
        if (pageId === 'dashboard') {
            updateDashboard();
        }
        
        // إذا كانت الدردشة، تحديث الرسائل
        if (pageId === 'chat') {
            updateChatMessages();
        }
        
        // إذا كانت صفحة التسجيل، إعادة تعيين الخطوات
        if (pageId === 'register') {
            resetRegistrationSteps();
        }
    }
    
    function getNavIndex(pageId) {
        const pages = ['home', 'register', 'dashboard', 'chat', 'about'];
        return pages.indexOf(pageId) + 1;
    }
    
    function resetRegistrationSteps() {
        currentStep = 1;
        updateStepIndicators();
        
        document.querySelectorAll('.form-step').forEach(step => {
            step.classList.remove('active');
        });
        
        const step1Form = document.getElementById('step1-form');
        if (step1Form) {
            step1Form.classList.add('active');
        }
        
        // إعادة تعيين الأخطاء
        resetValidationErrors();
    }
    
    // ==============================================
    // 3. إدارة خطوات التسجيل
    // ==============================================
    
    function validateAndNext(step) {
        if (step === 1) {
            if (!validateStep1()) {
                return;
            }
        }
        
        if (step === 2) {
            if (!selectedPlan) {
                showNotification('الرَّجَاء اخْتِيَار نَوْع الجَمْعِيَّة أَوَّلاً', 'error');
                return;
            }
        }
        
        nextStep(step + 1);
    }
    
    function nextStep(step) {
        // إخفاء الخطوة الحالية
        document.querySelectorAll('.form-step').forEach(formStep => {
            formStep.classList.remove('active');
        });
        
        // إظهار الخطوة الجديدة
        const targetForm = document.getElementById(`step${step}-form`);
        if (targetForm) {
            targetForm.classList.add('active');
        }
        
        // تحديث المؤشرات
        currentStep = step;
        updateStepIndicators();
        
        // إذا كانت الخطوة 3، تحديث بيانات المراجعة
        if (step === 3) {
            updateReviewData();
        }
    }
    
    function prevStep() {
        if (currentStep > 1) {
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            
            const prevForm = document.getElementById(`step${currentStep - 1}-form`);
            if (prevForm) {
                prevForm.classList.add('active');
            }
            
            currentStep--;
            updateStepIndicators();
        }
    }
    
    // ==============================================
    // 4. التحقق من البيانات
    // ==============================================
    
    function validateStep1() {
        let isValid = true;
        
        // إعادة تعيين الأخطاء
        resetValidationErrors();
        
        // التحقق من الاسم
        const fullName = document.getElementById('fullName').value.trim();
        const arabicRegex = /^[\u0600-\u06FF\s]{3,}$/;
        if (!arabicRegex.test(fullName)) {
            showError('fullNameError', 'الرَّجَاء إِدْخَال اسم صَحِيح (عربي فقط، 3 حروف على الأقل)');
            isValid = false;
        }
        
        // التحقق من رقم الهوية
        const nationalId = document.getElementById('nationalId').value.replace(/\D/g, '');
        if (nationalId.length !== 10) {
            showError('nationalIdError', 'رَقَم الهُوِيَّة يَجِب أَنْ يَكُونَ ١٠ أَرْقَام');
            isValid = false;
        }
        
        // التحقق من رقم الجوال
        const phone = document.getElementById('phone').value.replace(/\D/g, '');
        if (!phone.startsWith('05') || phone.length !== 10) {
            showError('phoneError', 'رَقَم الجَوَّال يَجِب أَنْ يَبْدَأ بـ ٠٥ وَيَكُونَ ١٠ أَرْقَام');
            isValid = false;
        }
        
        // التحقق من البريد الإلكتروني
        const email = document.getElementById('email').value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showError('emailError', 'الرَّجَاء إِدْخَال بَرِيد إلِكْتِرُونِيّ صَحِيح');
            isValid = false;
        }
        
        // التحقق من المدينة
        const city = document.getElementById('city').value;
        if (!city) {
            showError('cityError', 'الرَّجَاء اخْتِيَار المَدِينَة');
            isValid = false;
        }
        
        // التحقق من تاريخ الميلاد
        const birthDate = document.getElementById('birthDate').value;
        if (!birthDate) {
            showError('birthDateError', 'الرَّجَاء إِدْخَال تَارِيخ المِيلَاد');
            isValid = false;
        } else {
            const birthDateObj = new Date(birthDate);
            const today = new Date();
            const age = today.getFullYear() - birthDateObj.getFullYear();
            if (age < 18) {
                showError('birthDateError', 'يَجِب أَنْ يَكُونَ العُمْر ١٨ سَنَةً فَأَكْثَر');
                isValid = false;
            }
        }
        
        return isValid;
    }
    
    function showError(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = message;
            element.style.display = 'block';
        }
    }
    
    function resetValidationErrors() {
        const errorElements = document.querySelectorAll('.text-danger');
        errorElements.forEach(element => {
            element.style.display = 'none';
        });
    }
    
    // ==============================================
    // 5. اختيار الجمعية
    // ==============================================
    
    function selectPlan(planType) {
        selectedPlan = planType;
        
        document.querySelectorAll('.plan-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        const selectedCard = document.querySelector(`.plan-card[data-plan="${planType}"]`);
        if (selectedCard) {
            selectedCard.classList.add('selected');
        }
        
        const planNames = {
            '500': '٥٠٠ رِيَال',
            '1000': '١٬٠٠٠ رِيَال',
            '5000': '٥٬٠٠٠ رِيَال'
        };
        
        const selectedPlanText = document.getElementById('selectedPlanText');
        const selectedPlanName = document.getElementById('selectedPlanName');
        
        if (selectedPlanText && selectedPlanName) {
            selectedPlanText.style.display = 'block';
            selectedPlanName.textContent = planNames[planType] || planType;
        }
        
        showNotification(`تَمَّ اخْتِيَار جَمْعِيَّة ${planNames[planType] || planType}`, 'success');
    }
    
    // ==============================================
    // 6. اختيار البنك
    // ==============================================
    
    function selectBank(bankType) {
        selectedBank = bankType;
        
        document.querySelectorAll('.bank-option').forEach(option => {
            option.style.borderColor = '#dee2e6';
            option.style.background = 'white';
            option.style.boxShadow = 'none';
        });
        
        const selectedOption = document.getElementById(`${bankType}-option`);
        if (selectedOption) {
            selectedOption.style.borderColor = bankType === 'rajhi' ? 'var(--rajhi-red)' : 'var(--ahli-blue)';
            selectedOption.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
        }
        
        const bankNames = {
            'rajhi': 'الرَّاجِحِيّ',
            'ahli': 'الأَهْلِيّ'
        };
        
        showNotification(`تَمَّ اخْتِيَار بَنْك ${bankNames[bankType]}`, 'success');
    }
    
    function openBankApp(bankType) {
        const urls = {
            'rajhi': 'https://play.google.com/store/apps/details?id=com.alrajhiretailapp',
            'ahli': 'https://play.google.com/store/apps/details?id=com.snb.alahlimobile'
        };
        
        window.open(urls[bankType], '_blank');
    }
    
    // ==============================================
    // 7. تحديث بيانات المراجعة
    // ==============================================
    
    function updateReviewData() {
        const planNames = {
            '500': 'جَمْعِيَّة ٥٠٠ رِيَال',
            '1000': 'جَمْعِيَّة ١٬٠٠٠ رِيَال',
            '5000': 'جَمْعِيَّة ٥٬٠٠٠ رِيَال'
        };
        
        const bankNames = {
            'rajhi': 'بَنْك الرَّاجِحِيّ',
            'ahli': 'البَنْك الأَهْلِيّ'
        };
        
        const cityNames = {
            'riyadh': 'الرِّيَاض',
            'jeddah': 'جِدَّة',
            'mecca': 'مَكَّة المُكَرَّمَة',
            'medina': 'المَدِينَة المُنَوَّرَة',
            'dammam': 'الدَّمَام',
            'khobar': 'الخُبَر',
            'dhahran': 'الظَّهْرَان',
            'ahsa': 'الأَحْسَاء',
            'qatif': 'القَطِيف',
            'taif': 'الطَّائِف',
            'buraidah': 'بُرَيْدَة',
            'hail': 'حَائِل',
            'tabuk': 'تَبُوك',
            'jazan': 'جَازَان',
            'najran': 'نَجْرَان',
            'abha': 'أَبْهَا',
            'khamis': 'خَمِيس مُشَيْط',
            'yanbu': 'يَنْبُع',
            'jubail': 'الجُبَيْل',
            'hafr': 'حَفْر البَاطِن',
            'qassim': 'القَصِيم',
            'asir': 'عَسِير',
            'bahah': 'البَاحَة',
            'jawf': 'الجُوف',
            'northern': 'الحُدُود الشَّمَالِيَّة'
        };
        
        const data = {
            '👤 الاسْم': getValue('fullName'),
            '🆔 رَقَم الهُوِيَّة': getValue('nationalId'),
            '📱 رَقَم الجَوَّال': getValue('phone'),
            '📧 البَرِيد الإلِكْتِرُونِيّ': getValue('email'),
            '🏙️ المَدِينَة': cityNames[getValue('city')] || 'غير محدد',
            '💰 نَوْع الجَمْعِيَّة': selectedPlan ? planNames[selectedPlan] : 'لَمْ يَتِمَّ الاخْتِيَار',
            '🏦 البَنْك': selectedBank ? bankNames[selectedBank] : 'لَمْ يَتِمَّ الاخْتِيَار',
            '💳 رَقَم حِسَاب الجَمْعِيَّة': 'SA035600035686889898989898585'
        };
        
        const reviewDiv = document.getElementById('reviewData');
        if (reviewDiv) {
            reviewDiv.innerHTML = Object.entries(data).map(([key, value]) => `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #dee2e6; direction: rtl;">
                    <span style="color: #495057; font-weight: 500; text-align: right;">${key}</span>
                    <span style="color: var(--primary-blue); font-weight: 600; text-align: left;">${value}</span>
                </div>
            `).join('');
        }
    }
    
    function getValue(elementId) {
        const element = document.getElementById(elementId);
        return element ? element.value : '';
    }
    
    // ==============================================
    // 8. رفع الإيصالات
    // ==============================================
    
    function handleReceiptUpload(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            receiptFile = file;
            
            const fileName = document.getElementById('fileName');
            const receiptUpload = document.getElementById('receiptUpload');
            
            if (fileName) fileName.textContent = file.name;
            if (receiptUpload) {
                receiptUpload.style.borderColor = 'var(--success)';
                receiptUpload.style.background = 'rgba(46, 139, 87, 0.05)';
            }
            
            showNotification('تَمَّ رَفْعُ الإِيصَالِ بِنَجَاحٍ', 'success');
        }
    }
    
    function handlePaymentReceipt(input) {
        if (!currentUser) {
            showNotification('الرَّجَاء تَسْجِيل الدُّخُول أَوَّلاً', 'error');
            return;
        }
        
        if (input.files && input.files[0]) {
            const file = input.files[0];
            
            // تحديث دفعات المستخدم
            const month = (currentUser.payments ? currentUser.payments.length : 0) + 1;
            const amount = currentUser.plan === '500' ? 500 : 
                          currentUser.plan === '1000' ? 1000 : 
                          currentUser.plan === '5000' ? 5000 : 0;
            
            const payment = {
                month: month,
                amount: amount,
                date: new Date().toLocaleDateString('ar-SA'),
                receiptName: file.name,
                timestamp: new Date().toISOString()
            };
            
            if (!currentUser.payments) currentUser.payments = [];
            currentUser.payments.push(payment);
            
            if (!currentUser.totalPaid) currentUser.totalPaid = 0;
            currentUser.totalPaid += amount;
            
            // تحديث التخزين المحلي
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('cooperative_users', JSON.stringify(users));
            }
            
            showNotification(`تَمَّ رَفْعُ إِيصَالِ الدَّفْعِ لِلشَّهْرِ ${month} بِنَجَاحٍ`, 'success');
            updateDashboard();
        }
    }
    
    // ==============================================
    // 9. تسجيل العضو الجديد
    // ==============================================
    
    function submitRegistration() {
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
            submitBtn.innerHTML = '<div class="loading-spinner"></div> جَارِي التَّسْجِيل...';
            submitBtn.disabled = true;
        }
        
        setTimeout(() => {
            try {
                // التحقق من البيانات
                if (!validateStep1()) {
                    throw new Error('الرَّجَاء تَصْحِيحُ الأَخْطَاءِ فِي البَيَانَاتِ');
                }
                
                if (!selectedPlan) {
                    throw new Error('الرَّجَاء اخْتِيَارُ نَوْعِ الجَمْعِيَّةِ');
                }
                
                if (!selectedBank) {
                    throw new Error('الرَّجَاء اخْتِيَارُ البَنْكِ');
                }
                
                if (!receiptFile) {
                    throw new Error('الرَّجَاء رَفْعُ إِيصَالِ الدَّفْعِ');
                }
                
                const agreeTerms = document.getElementById('agreeTerms');
                if (!agreeTerms || !agreeTerms.checked) {
                    throw new Error('الرَّجَاء المُوافَقَةُ عَلَى الشُّرُوطِ وَالأَحْكَامِ');
                }
                
                // جمع البيانات
                const userData = {
                    fullName: getValue('fullName'),
                    nationalId: getValue('nationalId'),
                    phone: getValue('phone'),
                    email: getValue('email'),
                    city: getValue('city'),
                    birthDate: getValue('birthDate'),
                    plan: selectedPlan,
                    bank: selectedBank
                };
                
                // التحقق من عدم التسجيل المسبق
                if (users.find(u => u.nationalId === userData.nationalId)) {
                    throw new Error('رَقَمُ الهُوِيَّةِ مُسَجَّلٌ مُسْبَقًا');
                }
                
                if (users.find(u => u.phone === userData.phone)) {
                    throw new Error('رَقَمُ الجَوَّالِ مُسَجَّلٌ مُسْبَقًا');
                }
                
                // إنشاء رقم العضو
                const memberId = 'MEM' + Date.now().toString().slice(-6);
                const nextRole = users.length + 1;
                
                // حساب تاريخ الاستلام
                const receiveDate = calculateReceiveDate(nextRole);
                
                // إنشاء العضو
                const newUser = {
                    id: memberId,
                    ...userData,
                    iban: 'SA035600035686889898989898585',
                    role: nextRole,
                    receiveDate: receiveDate,
                    registrationDate: new Date().toISOString(),
                    status: 'active',
                    totalPaid: 0,
                    payments: [],
                    loginHistory: [{
                        timestamp: new Date().toISOString(),
                        action: 'registration'
                    }]
                };
                
                // حفظ العضو
                users.push(newUser);
                localStorage.setItem('cooperative_users', JSON.stringify(users));
                
                // تسجيل الدخول التلقائي
                currentUser = newUser;
                localStorage.setItem('last_login', memberId);
                
                showNotification(`مَبْرُوك! تَمَّ التَّسْجِيلُ بِنَجَاحٍ. رَقَمُ عُضُوِيَّتِكَ: ${memberId}`, 'success');
                
                // إعادة تعيين الزر
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> تَمَّ التَّسْجِيلُ بِنَجَاحٍ!';
                }
                
                // الانتقال إلى لوحة التحكم بعد 2 ثانية
                setTimeout(() => {
                    showPage('dashboard');
                }, 2000);
                
            } catch (error) {
                console.error('خطأ في التسجيل:', error);
                showNotification(error.message, 'error');
                
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> تَأْكِيد التَّسْجِيل';
                    submitBtn.disabled = false;
                }
            }
        }, 1500);
    }
    
    function calculateReceiveDate(role) {
        const startDate = new Date();
        startDate.setMonth(startDate.getMonth() + role);
        startDate.setDate(1);
        
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return startDate.toLocaleDateString('ar-SA', options);
    }
    
    // ==============================================
    // 10. تسجيل الدخول
    // ==============================================
    
    function loginUser() {
        const phoneInput = document.getElementById('loginPhone');
        if (!phoneInput) return;
        
        const phone = phoneInput.value.replace(/\D/g, '');
        if (!phone) {
            showNotification('الرَّجَاء إِدْخَالُ رَقَمِ الجَوَّالِ', 'error');
            return;
        }
        
        const user = users.find(u => u.phone && u.phone.replace(/\D/g, '') === phone);
        
        if (user) {
            currentUser = user;
            
            // تحديث سجل الدخول
            if (!user.loginHistory) user.loginHistory = [];
            user.loginHistory.push({
                timestamp: new Date().toISOString(),
                action: 'login'
            });
            
            localStorage.setItem('cooperative_users', JSON.stringify(users));
            localStorage.setItem('last_login', user.id);
            
            showNotification(`مَرْحَبًا بِعَوْدَتِكَ ${user.fullName}!`, 'success');
            updateDashboard();
            
        } else {
            showNotification('رَقَمُ الجَوَّالِ غَيْرُ مُسَجَّلٍ', 'error');
        }
    }
    
    function checkLoginStatus() {
        const lastLogin = localStorage.getItem('last_login');
        if (lastLogin) {
            const user = users.find(u => u.id === lastLogin);
            if (user) {
                currentUser = user;
                updateDashboard();
            }
        }
    }
    
    // ==============================================
    // 11. لوحة التحكم
    // ==============================================
    
    function updateDashboard() {
        const loginPrompt = document.getElementById('loginPrompt');
        const dashboardContent = document.getElementById('dashboardContent');
        
        if (!loginPrompt || !dashboardContent) return;
        
        if (currentUser) {
            loginPrompt.style.display = 'none';
            dashboardContent.style.display = 'block';
            
            // تحديث البيانات
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userId').textContent = `رَقَم العُضْو: ${currentUser.id}`;
            
            const planNames = {
                '500': '٥٠٠ رِيَال',
                '1000': '١٬٠٠٠ رِيَال',
                '5000': '٥٬٠٠٠ رِيَال'
            };
            
            document.getElementById('userPlan').textContent = planNames[currentUser.plan] || 'غَيْر مُحَدَّد';
            document.getElementById('userRole').textContent = `الدَّوْر: ${currentUser.role || 'غَيْر مُحَدَّد'}`;
            document.getElementById('totalPaid').textContent = `${(currentUser.totalPaid || 0).toLocaleString('ar-SA')} ر.س`;
            document.getElementById('receiveDate').textContent = currentUser.receiveDate || '-';
            
            updatePaymentHistory();
            
        } else {
            loginPrompt.style.display = 'block';
            dashboardContent.style.display = 'none';
        }
    }
    
    function updatePaymentHistory() {
        const container = document.getElementById('paymentHistory');
        if (!container) return;
        
        if (currentUser.payments && currentUser.payments.length > 0) {
            container.innerHTML = currentUser.payments.map(payment => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #dee2e6; direction: rtl;">
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: var(--primary-blue);">دَفْعَة شَهْر ${payment.month}</div>
                        <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">
                            <i class="fas fa-calendar"></i> ${payment.date || 'غَيْر مُحَدَّد'}
                        </div>
                    </div>
                    <div style="color: var(--success); font-weight: 600; font-size: 1.1em;">
                        ${(payment.amount || 0).toLocaleString('ar-SA')} ر.س
                    </div>
                </div>
            `).join('');
        } else {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-receipt" style="font-size: 3em; color: #adb5bd; margin-bottom: 20px;"></i>
                    <p style="color: #6c757d;">لَا تُوجَدُ دَفْعَات مُسَجَّلَة بَعْد</p>
                </div>
            `;
        }
    }
    
    // ==============================================
    // 12. الدردشة
    // ==============================================
    
    function loadMessages() {
        if (messages.length === 0) {
            messages.push({
                id: 1,
                sender: 'system',
                text: 'مَرْحَبًا بِكَ فِي الدَّرْدَشَةِ! كَيْفَ يُمْكِنُنِي مُسَاعَدَتُكَ الْيَوْمَ؟',
                timestamp: new Date().toISOString(),
                read: false
            });
            localStorage.setItem('cooperative_messages', JSON.stringify(messages));
        }
        
        updateChatMessages();
    }
    
    function sendMessage() {
        const input = document.getElementById('chatInput');
        if (!input) return;
        
        const message = input.value.trim();
        if (!message) return;
        
        // إضافة رسالة المستخدم
        messages.push({
            id: Date.now(),
            sender: 'user',
            text: message,
            timestamp: new Date().toISOString(),
            read: false
        });
        
        input.value = '';
        localStorage.setItem('cooperative_messages', JSON.stringify(messages));
        updateChatMessages();
        
        // رد تلقائي بعد ثانية
        setTimeout(() => {
            const responses = [
                "شُكْرًا لِرِسَالَتِكَ. سَأَرُدُّ عَلَيْكَ قَرِيبًا.",
                "تُمَّ اسْتِلَامُ رِسَالَتِكَ. كَيْفَ يُمْكِنُنِي مُسَاعَدَتُكَ فِي شُؤُونِ الجَمْعِيَّةِ؟",
                "هَلْ لَدَيْكَ اسْتِفْسَارٌ حَوْلَ دَفْعَتِكَ الشَّهْرِيَّةِ؟",
                "يُمْكِنُنِي مُسَاعَدَتُكَ فِي مَعْرِفَةِ دَوْرِكَ القَادِمِ فِي الجَمْعِيَّةِ."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            messages.push({
                id: Date.now() + 1,
                sender: 'system',
                text: randomResponse,
                timestamp: new Date().toISOString(),
                read: false
            });
            
            localStorage.setItem('cooperative_messages', JSON.stringify(messages));
            updateChatMessages();
            
        }, 1000);
    }
    
    function updateChatMessages() {
        const container = document.getElementById('messagesList');
        if (!container) return;
        
        const sortedMessages = [...messages].sort((a, b) => 
            new Date(a.timestamp) - new Date(b.timestamp)
        );
        
        container.innerHTML = sortedMessages.map(msg => {
            const isUser = msg.sender === 'user';
            return `
                <div class="message ${isUser ? 'user' : 'system'}" style="margin-bottom: 15px;">
                    <div style="
                        background: ${isUser ? 'var(--primary-blue)' : '#f1f3f4'};
                        color: ${isUser ? 'white' : '#495057'};
                        padding: 12px 16px;
                        border-radius: ${isUser ? '15px 15px 0 15px' : '15px 15px 15px 0'};
                        max-width: 70%;
                        display: inline-block;
                        text-align: ${isUser ? 'left' : 'right'};
                    ">
                        <div style="font-size: 0.95em;" class="tashkeel">${msg.text}</div>
                        <div style="
                            font-size: 0.75em;
                            margin-top: 5px;
                            opacity: 0.7;
                            text-align: ${isUser ? 'left' : 'right'};
                        ">
                            ${formatTime(msg.timestamp)}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        container.scrollTop = container.scrollHeight;
    }
    
    function formatTime(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleTimeString('ar-SA', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
    }
    
    // ==============================================
    // 13. نافذة تسجيل الدخول
    // ==============================================
    
    function openLogin() {
        document.getElementById('loginModal').style.display = 'flex';
    }
    
    function closeLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
    }
    
    function modalLogin() {
        const phoneInput = document.getElementById('modalPhone');
        if (!phoneInput) return;
        
        const phone = phoneInput.value.replace(/\D/g, '');
        if (!phone) {
            showNotification('الرَّجَاء إِدْخَالُ رَقَمِ الجَوَّالِ', 'error');
            return;
        }
        
        const user = users.find(u => u.phone && u.phone.replace(/\D/g, '') === phone);
        
        if (user) {
            currentUser = user;
            localStorage.setItem('last_login', user.id);
            showNotification(`مَرْحَبًا ${user.fullName}!`, 'success');
            updateDashboard();
            closeLoginModal();
            showPage('dashboard');
        } else {
            showNotification('رَقَمُ الجَوَّالِ غَيْرُ مُسَجَّلٍ', 'error');
        }
    }
    
    // ==============================================
    // 14. الإشعارات
    // ==============================================
    
    function showNotification(message, type = 'info') {
        const modal = document.getElementById('notificationModal');
        const messageEl = document.getElementById('notificationMessage');
        
        if (!modal || !messageEl) return;
        
        messageEl.textContent = message;
        
        const icon = modal.querySelector('i');
        if (icon) {
            if (type === 'success') {
                icon.style.color = '#2E8B57';
            } else if (type === 'error') {
                icon.style.color = '#CE1126';
            } else {
                icon.style.color = '#1A5F7A';
            }
        }
        
        modal.style.display = 'block';
        
        setTimeout(() => {
            modal.style.display = 'none';
        }, 5000);
    }
    
    function closeNotification() {
        document.getElementById('notificationModal').style.display = 'none';
    }
    
    // ==============================================
    // 15. تتبع الزوار
    // ==============================================
    
    function trackVisitor() {
        const sessionKey = 'cooperative_visitor_tracked';
        if (sessionStorage.getItem(sessionKey)) {
            return;
        }
        
        const visitorId = 'VISIT_' + Date.now();
        const visitorData = {
            id: visitorId,
            timestamp: new Date().toISOString(),
            lastVisit: new Date().toLocaleString('ar-SA'),
            userAgent: navigator.userAgent
        };
        
        visitors.push(visitorData);
        localStorage.setItem('cooperative_visitors', JSON.stringify(visitors));
        sessionStorage.setItem(sessionKey, 'true');
    }
    
    // ==============================================
    // 16. إعداد مستمعي الأحداث
    // ==============================================
    
    function setupEventListeners() {
        // الدردشة
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }
        
        // التحقق من البيانات أثناء الكتابة
        document.getElementById('fullName')?.addEventListener('input', function() {
            const arabicRegex = /^[\u0600-\u06FF\s]{3,}$/;
            if (!arabicRegex.test(this.value.trim())) {
                showError('fullNameError', 'الرَّجَاء إِدْخَال اسم صَحِيح (عربي فقط، 3 حروف على الأقل)');
            } else {
                document.getElementById('fullNameError').style.display = 'none';
            }
        });
        
        document.getElementById('nationalId')?.addEventListener('input', function() {
            const value = this.value.replace(/\D/g, '');
            if (value.length !== 10) {
                showError('nationalIdError', 'رَقَم الهُوِيَّة يَجِب أَنْ يَكُونَ ١٠ أَرْقَام');
            } else {
                document.getElementById('nationalIdError').style.display = 'none';
            }
        });
        
        document.getElementById('phone')?.addEventListener('input', function() {
            const value = this.value.replace(/\D/g, '');
            if (!value.startsWith('05') || value.length !== 10) {
                showError('phoneError', 'رَقَم الجَوَّال يَجِب أَنْ يَبْدَأ بـ ٠٥ وَيَكُونَ ١٠ أَرْقَام');
            } else {
                document.getElementById('phoneError').style.display = 'none';
            }
        });
    }
    
    // ==============================================
    // 17. تهيئة النظام عند تحميل الصفحة
    // ==============================================
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('الصفحة تم تحميلها بنجاح');
        initSystem();
        
        // تعيين الصفحة الأولى كافتراضية
        showPage('home');
    });
    </script>
</body>
</html>
